colnames(cpue)=c("YEAR","AVGCPUE")
ggplot(cpue)+geom_line(aes(x=YEAR,y=AVGCPUE),size=1.2)+labs(x = "Year", y = "CPUE")+geom_point(aes(x=YEAR,y=AVGCPUE),size=3)+labs(x = "Year", y = "CPUE")+ylab("Average catch per unit effort, kg/hectare")+theme_bw()
cpue
sapply(cpue,class)
cpue=data.frame(cbind(yrs,round(cpuevec/100,2))[6:40,])
colnames(cpue)=c("YEAR","AVGCPUE")
ggplot(cpue)+geom_line(aes(x=YEAR,y=AVGCPUE),size=1.2)+labs(x = "Year", y = "CPUE")+geom_point(aes(x=YEAR,y=AVGCPUE),size=3)+labs(x = "Year", y = "CPUE")+ylab("Average catch per unit effort, kg/hectare")+theme_bw()
YFS18_2$ob_bts
YFS18_2$Yr
YFS18_2$yrs_srv
LCI=YFS18_2$ob_bts-1.96*YFS18_2$sd_ob_bts
LCI
HCI=YFS18_2$ob_bts+1.96*YFS18_2$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA),srv_bio[39:40,]))
srv_bio2
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2020")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2020),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv),color="red",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2021, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2020, blue) fit to survey estimate.")
PredSrv
srv_bio3
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv),color="red",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv),color="red",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
srv_bio3
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)
srv_bio3
YFS18_2$TotBiom[c(29:69)
]
srv_bio2
YFS18_2$TotBiom[c(29:69),c(1,2,4,5)]
YFS18_2$pred_srv[29:69]
YFS2021$pred_srv[29:69]
cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
srv_bio3
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:40,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:40,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv),color="red",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv),color="red",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_line(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
srv_bio3
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_line(data=srv_bio3[391,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
srv_bio3
srv_bio3[39:40]
srv_bio3[39:40,]
srv_bio3[40:41,]
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_line(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],)
YFS22_1=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_1/fm.rep")
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],)
YFS22_1$TotBiom
YFS22_1$TotBiom[c(29:69),c(1,2,4,5)]
YFS18_2$TotBiom[c(29:69),c(1,2,4,5)]
cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],)
cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],)
cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","yr3","M22_1","MLCI2","MHCI2","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
dim(srv_bio3)
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
dim(srv_bio3)
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","yr3","M22_1","MLCI2","MHCI2","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3,aes(x=Year,y=M22_1),na.rm=TRUE,color="orange",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,4100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3,aes(x=Year,y=M22_1),na.rm=TRUE,color="orange",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
YFS22_1$ob_bts
cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$ob_bts,YFS22_1$sd_ob_bts,YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
srv_bio3
dim(srv_bio3)
length(YFS22_1$ob_bts)
LCI_VAST=YFS22_1$ob_bts-1.96*YFS22_1$sd_ob_bts
HCI_VAST=YFS22_1$ob_bts+1.96*YFS22_1$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI))
dim(srv_bio)
length(YFS22_1$ob_bts)
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI,YFS22_1$ob_bts,LCI_VAST,HCI_VAST))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA),srv_bio[39:40,]))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA,NA,NA),srv_bio[39:40,]))
rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA),srv_bio[39:40,])
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(NA,NA,NA,NA,NA),srv_bio[39:40,]))
data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA),srv_bio[39:40,]))
LCI=YFS18_2$ob_bts-1.96*YFS18_2$sd_ob_bts
HCI=YFS18_2$ob_bts+1.96*YFS18_2$sd_ob_bts
LCI_VAST=YFS22_1$ob_bts-1.96*YFS22_1$sd_ob_bts
HCI_VAST=YFS22_1$ob_bts+1.96*YFS22_1$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI,YFS22_1$ob_bts,LCI_VAST,HCI_VAST))
srv_bio
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA,NA,NA,NA),srv_bio[39:40,]))
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
head(srv_bio3)
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3,aes(x=Year,y=V6),na.rm=TRUE,color="orange",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
head(srv_bio3)
LCI=YFS18_2$ob_bts-1.96*YFS18_2$sd_ob_bts
HCI=YFS18_2$ob_bts+1.96*YFS18_2$sd_ob_bts
LCI_VAST=YFS22_1$ob_bts-1.96*YFS22_1$sd_ob_bts
HCI_VAST=YFS22_1$ob_bts+1.96*YFS22_1$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI,YFS22_1$ob_bts,LCI_VAST,HCI_VAST))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA,NA,NA,NA),srv_bio[39:40,]))
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS22_1$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","M22_1","LCI_VAST","HCI_VAST","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
srv_bio3
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","M22_1","LCI_VAST","HCI_VAST","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3,aes(x=Year,y=V6),na.rm=TRUE,color="orange",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","M22_1","LCI_VAST","HCI_VAST","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3,aes(x=Year,y=M22_1),na.rm=TRUE,color="orange",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3,aes(x=Year,y=M22_1),na.rm=TRUE,color="orange",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],YFS22_1$TotBiom)
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],YFS22_1$TotBiom)
YFS22_1$TotBiom
YFS22_1$TotBiom[29:69,2]
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],YFS22_1$TotBiom[29:69,2])
ggplot(data=srv_bio3)+geom_point(aes(x=Year,y=Biomass))+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+theme_bw()+theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
LCI=YFS18_2$ob_bts-1.96*YFS18_2$sd_ob_bts
HCI=YFS18_2$ob_bts+1.96*YFS18_2$sd_ob_bts
LCI_VAST=YFS22_1$ob_bts-1.96*YFS22_1$sd_ob_bts
HCI_VAST=YFS22_1$ob_bts+1.96*YFS22_1$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI,YFS22_1$ob_bts,LCI_VAST,HCI_VAST))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA,NA,NA,NA),srv_bio[39:40,]))
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],YFS22_1$TotBiom[29:69,2])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","M22_1_obsbts","LCI_VAST","HCI_VAST","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021","Pred_M22_1")
srv_bio3
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+
theme_bw()+
theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+
ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue) fit to survey estimate.")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+
theme_bw()+
theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+
ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue), and Model 22.1 (orange) fit to survey estimate.")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+
theme_bw()+
theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+
ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue), and Model 22.1 (orange) fit to \nsurvey estimate.")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+
theme_bw()+
theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+
ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue), and Model 22.1 (orange) fit to \nsurvey estimate (EBS = black, NBS+EBS = grey).")
LCI=YFS18_2$ob_bts-1.96*YFS18_2$sd_ob_bts
HCI=YFS18_2$ob_bts+1.96*YFS18_2$sd_ob_bts
LCI_VAST=YFS22_1$ob_bts-1.96*YFS22_1$sd_ob_bts
HCI_VAST=YFS22_1$ob_bts+1.96*YFS22_1$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI,YFS22_1$ob_bts,LCI_VAST,HCI_VAST))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA,NA,NA,NA),srv_bio[39:40,]))
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],YFS22_0$TotBiom[29:69,2])
YFS22_0=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_0/fm.rep")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+
theme_bw()+
theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+
ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue), and Model 22.1 (orange) fit to \nsurvey estimate (EBS = black, NBS+EBS = grey).")
LCI=YFS18_2$ob_bts-1.96*YFS18_2$sd_ob_bts
HCI=YFS18_2$ob_bts+1.96*YFS18_2$sd_ob_bts
LCI_VAST=YFS22_1$ob_bts-1.96*YFS22_1$sd_ob_bts
HCI_VAST=YFS22_1$ob_bts+1.96*YFS22_1$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI,YFS22_1$ob_bts,LCI_VAST,HCI_VAST))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA,NA,NA,NA),srv_bio[39:40,]))
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],YFS22_0$TotBiom[29:69,2])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","M22_1_obsbts","LCI_VAST","HCI_VAST","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021","Pred_M22_1")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+
theme_bw()+
theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+
ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue), and Model 22.1 (orange) fit to \nsurvey estimate (EBS = black, NBS+EBS = grey).")
LCI=YFS18_2$ob_bts-1.96*YFS18_2$sd_ob_bts
HCI=YFS18_2$ob_bts+1.96*YFS18_2$sd_ob_bts
LCI_VAST=YFS22_1$ob_bts-1.96*YFS22_1$sd_ob_bts
HCI_VAST=YFS22_1$ob_bts+1.96*YFS22_1$sd_ob_bts
srv_bio=data.frame(cbind(YFS18_2$yrs_srv,YFS18_2$ob_bts,YFS18_2$sd_ob_bts,LCI,HCI,YFS22_0$ob_bts,LCI_VAST,HCI_VAST))
#add in yr=2020
srv_bio2=data.frame(rbind(srv_bio[1:38,],c(2020,NA,NA,NA,NA,NA,NA,NA),srv_bio[39:40,]))
srv_bio3=cbind(srv_bio2,YFS18_2$TotBiom[c(29:69),c(1,2,4,5)],YFS18_2$pred_srv[29:69],YFS2021$pred_srv[29:69],YFS22_1$TotBiom[29:69,2])
colnames(srv_bio3)=c("Year","Biomass","sd","LCI","HCI","M22_1_obsbts","LCI_VAST","HCI_VAST","yr2","Model","MLCI","MHCI","PredSrv","PredSrv_2021","Pred_M22_1")
ggplot(data=srv_bio3)+
geom_point(aes(x=Year,y=Biomass))+geom_point(aes(x=Year,y=M22_1_obsbts),col="grey")+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3,aes(x=Year,y=Pred_M22_1),na.rm=TRUE,color="orange",size=2)+
geom_line(data=srv_bio3[40:41,],aes(x=Year,y=PredSrv),na.rm=TRUE,color="red",size=2)+
geom_line(data=srv_bio3[1:38,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_point(data=srv_bio3[40,],aes(x=Year,y=PredSrv_2021),na.rm=TRUE,color="blue",size=2)+
geom_errorbar(aes(x=Year,ymin=LCI,ymax=HCI),width=.1)+
geom_errorbar(aes(x=Year,ymin=LCI_VAST,ymax=HCI_VAST),width=.1,col="grey")+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Biomass (x 1,000 t)")+scale_x_continuous(breaks = seq(1982,2022, by = 2))+
theme_bw()+
theme(axis.text.x=element_text(angle=90,hjust=1))+ylim(0,5100)+theme(legend.position="right")+scale_color_discrete(name="")+
ggtitle("Survey estimates of biomass (black), Model 18.2 (red) \nand Model 18.2 (2021, blue), and Model 22.1 (orange) fit to \nsurvey estimate (EBS = black, NBS+EBS = grey).")
df <- data.frame(YFS18_2$SRR_SSB)
df$Year <- YFS18_2$Year
df$rhat <- YFS18_2$rechat
df$rhat.sd <- YFS18_2$rechat.sd
df$lb   <- df$rhat/exp(2*sqrt(log(1+df$rhat.sd^2/df$rhat^2)))
df$ub   <- df$rhat*exp(2*sqrt(log(1+df$rhat.sd^2/df$rhat^2)))
colnames(df)=c("ssb","rhat","rhat.sd","lb","ub")
df2=data.frame(YFS18_2$Yr[62:69],YFS18_2$SSB[62:69,2],(YFS18_2$natage_f[62:69,1]+YFS18_2$natage_m[62:69,1]))
df3=data.frame(YFS18_2$Yr[25:63],YFS18_2$SSB[25:63,2],(YFS18_2$natage_f[25:63,1]+YFS18_2$natage_m[25:63,1]))
colnames(df2)=c("Year","FSB","Recruitment")
colnames(df3)=c("Year","FSB","Recruitment")
ggplot(df) +geom_line(aes(x = ssb, y = rhat)) +
geom_ribbon(aes(x = ssb, ymax = ub, ymin = lb), alpha=0.3)+labs(x = "Female spawning biomass (x 1,000 t)", y = "Recruits (age 1, billions)")+geom_text(data=df2,aes(x = FSB, y = Recruitment,label=Year),color="blue")+geom_text(data=df3,aes(x = FSB, y = Recruitment,label=Year))+ggtitle("Model 18.2")+theme_bw()
YFS18_2$Yr[62:69]
df <- data.frame(YFS18_2$SRR_SSB)
df$Year <- YFS18_2$Year
df$rhat <- YFS18_2$rechat
df$rhat.sd <- YFS18_2$rechat.sd
df$lb   <- df$rhat/exp(2*sqrt(log(1+df$rhat.sd^2/df$rhat^2)))
df$ub   <- df$rhat*exp(2*sqrt(log(1+df$rhat.sd^2/df$rhat^2)))
colnames(df)=c("ssb","rhat","rhat.sd","lb","ub")
df2=data.frame(YFS18_2$Yr[64:69],YFS18_2$SSB[64:69,2],(YFS18_2$natage_f[64:69,1]+YFS18_2$natage_m[64:69,1]))
df3=data.frame(YFS18_2$Yr[25:63],YFS18_2$SSB[25:63,2],(YFS18_2$natage_f[25:63,1]+YFS18_2$natage_m[25:63,1]))
colnames(df2)=c("Year","FSB","Recruitment")
colnames(df3)=c("Year","FSB","Recruitment")
ggplot(df) +geom_line(aes(x = ssb, y = rhat)) +
geom_ribbon(aes(x = ssb, ymax = ub, ymin = lb), alpha=0.3)+labs(x = "Female spawning biomass (x 1,000 t)", y = "Recruits (age 1, billions)")+geom_text(data=df2,aes(x = FSB, y = Recruitment,label=Year),color="blue")+geom_text(data=df3,aes(x = FSB, y = Recruitment,label=Year))+ggtitle("Model 18.2")+theme_bw()
srvF=data.frame(cbind(seq(1954,2022,1),YFS18_2$wt_srv_f))
colnames(srvF)=c("Year",seq(1,20,1))
#srvF$Year=as.factor(srvF$Year)#changes legend to rainbow
YFF=reshape2::melt(srvF,id="Year");colnames(YFF)=c("Year","Age","Weight")
YFF_fig=ggplot(YFF)+geom_point(aes(x=Age,y=Weight,color=Year))+geom_point(data=YFF[which(YFF$Year==2022),],aes(x=Age,y=Weight),color="orange",size=3)+theme_bw()+ggtitle("Female survey weight at age used in 2021 model")#
srvM=data.frame(cbind(seq(1954,2022,1),YFS18_2$wt_srv_m))
colnames(srvM)=c("Year",seq(1,20,1))
#srvM$Year=as.factor(srvM$Year)
YFM=reshape2::melt(srvM,id="Year");colnames(YFM)=c("Year","Age","Weight")
YFM_fig=ggplot(YFM)+geom_point(aes(x=Age,y=Weight,color=Year))+geom_point(data=YFM[which(YFM$Year==2022),],aes(x=Age,y=Weight),color="orange",size=3)+theme_bw()+ggtitle("Male survey weight at age used in 2022 model")#
grid.arrange(YFF_fig,YFM_fig,ncol=1)
srvsel2=data.frame(cbind(seq(1,20,1),YFS18_2$sel_srv_f,YFS18_2$sel_srv_m))
colnames(srvsel2)=c("Age","Female","Male")
p2=ggplot(data=srvsel2)+geom_line(aes(x=Age,y=Female,col="Female"))+geom_line(aes(x=Age,y=Male,col="Male"))+theme_bw()+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Proportion selected")+scale_x_continuous(breaks = seq(1,20, by = 2))+scale_color_discrete(name="")+ggtitle("Model 18.2")
srvsel2=data.frame(cbind(seq(1,20,1),YFS18_2$sel_srv_f,YFS18_2$sel_srv_m))
colnames(srvsel2)=c("Age","Female","Male")
p2=ggplot(data=srvsel2)+geom_line(aes(x=Age,y=Female,col="Female"))+geom_line(aes(x=Age,y=Male,col="Male"))+theme_bw()+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Proportion selected")+scale_x_continuous(breaks = seq(1,20, by = 2))+scale_color_discrete(name="")+ggtitle("Model 18.2")
p2
YFS18_2$sel_srv_m
YFS18_2$sel_srv_f
srvsel1=data.frame(cbind(seq(1,20,1),YFS22_0$sel_srv_f,YFS22_0$sel_srv_m))
colnames(srvsel1)=c("Age","Female","Male")
p1=ggplot(data=srvsel1)+geom_line(aes(x=Age,y=Female,col="Female"))+geom_line(aes(x=Age,y=Male,col="Male"))+theme_bw()+
theme(legend.title=element_text(size=13),legend.text=element_text(size=11),axis.text=element_text(size=11),axis.title.x = element_text(size=13),axis.title.y = element_text(size=14))+
ylab("Proportion selected")+scale_x_continuous(breaks = seq(1,20, by = 2))+scale_color_discrete(name="")+ggtitle("Model 22.0")
grid.arrange(p1, p2, ncol = 1)
length(seq(1954,2022))
sf=data.frame(rep(seq(1954,2022,1),20),rep(seq(1,20,1),each=69),as.vector(YFS22_1$sel_fsh_f))
colnames(sf)=c("Year","Age","Selectivity")
sf=data.frame(rep(seq(1954,2022,1),20),rep(seq(1,20,1),each=69),as.vector(YFS22_1$sel_fsh_f))
colnames(sf)=c("Year","Age","Selectivity")
ggplot(data=sf,x=Age,y=Selectivity)+geom_line(aes(x=Age,y=Selectivity))+facet_wrap(~Year)+theme_few()+ theme(axis.text.x = element_text(angle = 90, hjust = 1, size=7))+ theme(axis.text.y = element_text(angle = 0, hjust = 1, size=7))
library(ggthemes)
sf=data.frame(rep(seq(1954,2022,1),20),rep(seq(1,20,1),each=69),as.vector(YFS22_1$sel_fsh_f))
colnames(sf)=c("Year","Age","Selectivity")
ggplot(data=sf,x=Age,y=Selectivity)+geom_line(aes(x=Age,y=Selectivity))+facet_wrap(~Year)+theme_few()+ theme(axis.text.x = element_text(angle = 90, hjust = 1, size=7))+ theme(axis.text.y = element_text(angle = 0, hjust = 1, size=7))
mdf <- data.frame(Year=YFS18_2$Yr,Sex="males",YFS18_2$sel_fsh_m)
mdf <- rbind(mdf,data.frame(Year=YFS18_2$Yr,Sex="females",YFS18_2$sel_fsh_f))
names(mdf)[3:22] <- 1:20
sdf <- (gather(mdf,Age,selectivity,3:22) ) %>% filter(Year>=min(YFS18_2$Yr),Year<=max(YFS18_2$Yr)) %>% mutate(Age=as.numeric(Age)) #+ arrange(age,Year)
ggplot(sdf,aes(x=Age,y=fct_rev(as.factor(Year)),height = selectivity,fill=Sex,color=Sex,alpha=0.3)) +
geom_density_ridges(stat = "identity",scale=1,alpha = 0.3) + ylab("Year")+ theme(axis.text.y = element_text(angle = 0, hjust = 1, size=5))+theme_bw()
library(ggridges)
ggplot(sdf,aes(x=Age,y=fct_rev(as.factor(Year)),height = selectivity,fill=Sex,color=Sex,alpha=0.3)) +
geom_density_ridges(stat = "identity",scale=1,alpha = 0.3) + ylab("Year")+ theme(axis.text.y = element_text(angle = 0, hjust = 1, size=5))+theme_bw()
df <- data.frame( Year    = YFS18_2$yrs_srv )
df$Model <- "Model 18.2"
df$q_srv   <- YFS18_2$q_srv
df1 <- data.frame( Year    = YFS22.1$yrs_srv )
df <- data.frame( Year    = YFS18_2$yrs_srv )
df$Model <- "Model 18.2"
df$q_srv   <- YFS18_2$q_srv
df1 <- data.frame( Year    = YFS22_1$yrs_srv )
df1$Model <- "Model 22.1"
df1$q_srv   <- YFS2020$q_srv
df <- data.frame( Year    = YFS18_2$yrs_srv )
df$Model <- "Model 18.2"
df$q_srv   <- YFS18_2$q_srv
df1 <- data.frame( Year    = YFS22_1$yrs_srv )
df1$Model <- "Model 22.1"
df1$q_srv   <- YFS22_1$q_srv
df2=data.frame(rbind(df1,df))
ggplot(df2) +geom_line(aes(x = Year, y = q_srv, col = Model),size=1.2)+
labs(x = "Year", y = "Survey catchability")+theme_bw()
YFS22_1=read.rep("/Users/ingridspies/admbmodels/flatfish/assessments/yfs/runs/m22_1/fm.rep")#last years model
YFS22_1=read.rep("/Users/ingridspies/admbmodels/flatfish/assessments/yfs/runs/m22_1/fm.rep")#last years model
YFS22_1=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_1/fm.rep")#last years model
YFS18_2=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m18_2/fm.rep")#this is the preferred model. Male M is estimated.
df <- data.frame(rowSums(YFS18_2$natage_f)/rowSums(YFS18_2$natage_f+YFS18_2$natage_m))
df$Model <- "Model 18.2"
df$Year=YFS18_2$Yr
colnames(df)=c("Sex_Ratio","Model","Year")
df1 <- data.frame(rowSums(YFS22_1$natage_f)/rowSums(YFS22_1$natage_f+YFS22_1$natage_m))
df1$Model <- "Model 22.1"
df1$Year=YFS22_1$Yr
colnames(df1)=c("Sex_Ratio","Model","Year")
df2=rbind(df1,df)
ggplot(df2) + geom_point(data=df2, aes(x = Year, y = Sex_Ratio,color=Model),size=3)+labs(xlab = "Year", ylab = "Proportion female")+
ylab("Proportion Female")+theme_bw()
thin <- 10000
iter <- 1000*thin
fit <- sample_rwm(model=m, path=p, iter=iter, warmup=iter/4,
chains=chains, thin=thin)#This one takes a while
p <- '/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_0/'                                   # path to model
p <- '/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_1/'                                   # path to model
## Assumes current working directory is where this R script is
setwd("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_1")
(wd <- getwd())
## It also assumes the model was optimized with successful
## inversion of the matrix to create the admodel.cov file. If not
## rerun it.
setwd(p)
## system(paste(m, '-nox -iprint 1000'))
## If an SS model better to optimize with -mcmc flag
system(paste(m, '-nox -iprint 1000 -mcmc 10'))
setwd(wd)
## How many parallel chains to use? I recommend using all cores
## but one for laptops. Probably not needed to run more than 8 in
## most cases.
(chains <- parallel::detectCores()-1)
thin <- 10000
iter <- 1000*thin
fit <- sample_rwm(model=m, path=p, iter=iter, warmup=iter/4,
chains=chains, thin=thin)#This one takes a while
fit <- sample_rwm(model=m, path=p, iter=iter, warmup=iter/4,
chains=chains, thin=thin)#This one takes a while
m <- './fm'                               # model name
p <- '/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_1/'                                   # path to model
## Assumes current working directory is where this R script is
setwd("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_1")
(wd <- getwd())
## It also assumes the model was optimized with successful
## inversion of the matrix to create the admodel.cov file. If not
## rerun it.
setwd(p)
## system(paste(m, '-nox -iprint 1000'))
## If an SS model better to optimize with -mcmc flag
system(paste(m, '-nox -iprint 1000 -mcmc 10'))
setwd(wd)
## How many parallel chains to use? I recommend using all cores
## but one for laptops. Probably not needed to run more than 8 in
## most cases.
(chains <- parallel::detectCores()-1)
### ------------------------------------------------------------
### Step 1: Run and demonstrate MCMC convergence diagnostics.
## I recommend using 1000-2000 iterations, with first 25%
## warmup. Start with thin=1, then increase thin rate until
## convergence diagnostics passed (ESS>200 & Rhat<1.1).
## !! Note in some environments like RStudio parallel output is
## not printed to screen !!
thin <- 10000
iter <- 1000*thin
fit <- sample_rwm(model=m, path=p, iter=iter, warmup=iter/4,
chains=chains, thin=thin)#This one takes a while
library(adnuts)                         # 1.1.0
library(shinystan)
fit <- sample_rwm(model=m, path=p, iter=iter, warmup=iter/4,
chains=chains, thin=thin)#This one takes a while
## Assumes current working directory is where this R script is
setwd("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_0")
library(adnuts)                         # 1.1.0
library(shinystan)
## Define the path and model name
m <- './fm'                               # model name
p <- '/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_1/'                                   # path to model
p <- '/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_0/'                                   # path to model
## Assumes current working directory is where this R script is
setwd("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/m22_0")
(wd <- getwd())
## It also assumes the model was optimized with successful
## inversion of the matrix to create the admodel.cov file. If not
## rerun it.
setwd(p)
getwd()
## system(paste(m, '-nox -iprint 1000'))
## If an SS model better to optimize with -mcmc flag
system(paste(m, '-nox -iprint 1000 -mcmc 10'))
## How many parallel chains to use? I recommend using all cores
## but one for laptops. Probably not needed to run more than 8 in
## most cases.
(chains <- parallel::detectCores()-1)
iter <- 10*thin#1000*thin
fit <- sample_rwm(model=m, path=p, iter=iter, warmup=iter/4,
chains=chains, thin=thin)#This one takes a while
