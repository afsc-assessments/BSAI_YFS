a=-1*(YFS2022$SSB[1:68,2]-YFS2021$SSB[,2])/YFS2022$SSB[1:68,2]
b=-1*(YFS2022$SSB[1:67,2]-YFS2020$SSB[,2])/YFS2022$SSB[1:67,2]
c=-1*(YFS2022$SSB[1:66,2]-YFS2019$SSB[,2])/YFS2022$SSB[1:66,2]
d=-1*(YFS2022$SSB[1:65,2]-YFS2018$SSB[,2])/YFS2022$SSB[1:65,2]
e=-1*(YFS2022$SSB[1:64,2]-YFS2017$SSB[,2])/YFS2022$SSB[1:64,2]
f=-1*(YFS2022$SSB[1:63,2]-YFS2016$SSB[,2])/YFS2022$SSB[1:63,2]
g=-1*(YFS2022$SSB[1:62,2]-YFS2015$SSB[,2])/YFS2022$SSB[1:62,2]
h=-1*(YFS2022$SSB[1:61,2]-YFS2014$SSB[,2])/YFS2022$SSB[1:61,2]
i=-1*(YFS2022$SSB[1:60,2]-YFS2013$SSB[,2])/YFS2022$SSB[1:60,2]
j=-1*(YFS2022$SSB[1:59,2]-YFS2012$SSB[,2])/YFS2022$SSB[1:59,2]
Rho22_1=(a[length(a)]+b[length(b)]+c[length(c)]+d[length(d)]+e[length(e)]+
f[length(f)]+g[length(g)]+h[length(h)]+i[length(i)]+j[length(j)])/10;
YFS2022=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_0/fm.rep")
YFS22_1$natmort_m
#retro 22.0
std2022=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_0/fm.std")
std2021=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_1/fm.std")
std2020=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_2/fm.std")
std2019=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_3/fm.std")
std2018=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_4/fm.std")
std2017=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_5/fm.std")
std2016=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_6/fm.std")
std2015=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_7/fm.std")
std2014=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_8/fm.std")
std2013=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_9/fm.std")
std2012=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_10/fm.std")
ret22=data.frame(cbind(c(1954:2021),YFS22_0$SSB[,2],YFS22_0$SSB[,2]+1.96*as.numeric(as.vector(std2021[['V4']][615:682])),YFS22_0$SSB[,2]-1.96*as.numeric(as.vector(std2021[['V4']][615:682]))))
ret21=data.frame(cbind(c(1954:2020),YFS2020r$SSB[,2],YFS2020r$SSB[,2]+1.96*as.numeric(as.vector(std2020[['V4']][608:674])),YFS2020r$SSB[,2]-1.96*as.numeric(as.vector(std2020[['V4']][608:674]))))
ret22=data.frame(cbind(c(1954:2022),YFS2022$SSB[,2],YFS2022$SSB[,2]+1.96*as.numeric(as.vector(std2022[['V4']][622:690])),YFS2022$SSB[,2]-1.96*as.numeric(as.vector(std2022[['V4']][622:690]))))
ret21=data.frame(cbind(c(1954:2021),YFS2021$SSB[,2],YFS2021$SSB[,2]+1.96*as.numeric(as.vector(std2021[['V4']][615:682])),YFS2021$SSB[,2]-1.96*as.numeric(as.vector(std2021[['V4']][615:682]))))
ret20=data.frame(cbind(c(1954:2020),YFS2020r$SSB[,2],YFS2020r$SSB[,2]+1.96*as.numeric(as.vector(std2020[['V4']][608:674])),YFS2020r$SSB[,2]-1.96*as.numeric(as.vector(std2020[['V4']][608:674]))))
ret20=data.frame(cbind(c(1954:2020),YFS2020$SSB[,2],YFS2020$SSB[,2]+1.96*as.numeric(as.vector(std2020[['V4']][608:674])),YFS2020$SSB[,2]-1.96*as.numeric(as.vector(std2020[['V4']][608:674]))))
YFS2021r=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_1/fm.rep")
YFS2022=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_0/fm.rep")
YFS2021r=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_1/fm.rep")
YFS2020=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_2/fm.rep")
YFS2019=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_3/fm.rep")
YFS2018=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_4/fm.rep")
YFS2017=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_5/fm.rep")
YFS2016=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_6/fm.rep")
YFS2015=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_7/fm.rep")
YFS2014=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_8/fm.rep")
YFS2013=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_9/fm.rep")
YFS2012=read.rep("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_10/fm.rep")
#retro 22.0
std2022=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_0/fm.std")
std2021=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_1/fm.std")
std2020=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_2/fm.std")
std2019=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_3/fm.std")
std2018=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_4/fm.std")
std2017=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_5/fm.std")
std2016=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_6/fm.std")
std2015=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_7/fm.std")
std2014=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_8/fm.std")
std2013=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_9/fm.std")
std2012=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_10/fm.std")
ret22=data.frame(cbind(c(1954:2022),YFS2022$SSB[,2],YFS2022$SSB[,2]+1.96*as.numeric(as.vector(std2022[['V4']][622:690])),YFS2022$SSB[,2]-1.96*as.numeric(as.vector(std2022[['V4']][622:690]))))
ret21=data.frame(cbind(c(1954:2021),YFS2021r$SSB[,2],YFS2021r$SSB[,2]+1.96*as.numeric(as.vector(std2021[['V4']][615:682])),YFS2021r$SSB[,2]-1.96*as.numeric(as.vector(std2021[['V4']][615:682]))))
ret20=data.frame(cbind(c(1954:2020),YFS2020$SSB[,2],YFS2020$SSB[,2]+1.96*as.numeric(as.vector(std2020[['V4']][608:674])),YFS2020$SSB[,2]-1.96*as.numeric(as.vector(std2020[['V4']][608:674]))))
ret19=data.frame(cbind(c(1954:2019),YFS2019$SSB[,2],YFS2019$SSB[,2]+1.96*as.numeric(as.vector(std2019[['V4']][601:666])),YFS2019$SSB[,2]-1.96*as.numeric(as.vector(std2019[['V4']][601:666]))))
ret18=data.frame(cbind(c(1954:2018),YFS2018$SSB[,2],YFS2018$SSB[,2]+1.96*as.numeric(as.vector(std2018[['V4']][594:658])),YFS2018$SSB[,2]-1.96*as.numeric(as.vector(std2018[['V4']][594:658]))))
ret17=data.frame(cbind(c(1954:2017),YFS2017$SSB[,2],YFS2017$SSB[,2]+1.96*as.numeric(as.vector(std2017[['V4']][587:650])),YFS2017$SSB[,2]-1.96*as.numeric(as.vector(std2017[['V4']][587:650]))))
ret16=data.frame(cbind(c(1954:2016),YFS2016$SSB[,2],YFS2016$SSB[,2]+1.96*as.numeric(as.vector(std2016[['V4']][580:642])),YFS2016$SSB[,2]-1.96*as.numeric(as.vector(std2016[['V4']][580:642]))))
ret15=data.frame(cbind(c(1954:2015),YFS2015$SSB[,2],YFS2015$SSB[,2]+1.96*as.numeric(as.vector(std2015[['V4']][573:634])),YFS2015$SSB[,2]-1.96*as.numeric(as.vector(std2015[['V4']][573:634]))))
ret14=data.frame(cbind(c(1954:2014),YFS2014$SSB[,2],YFS2014$SSB[,2]+1.96*as.numeric(as.vector(std2014[['V4']][566:626])),YFS2014$SSB[,2]-1.96*as.numeric(as.vector(std2014[['V4']][566:626]))))
ret13=data.frame(cbind(c(1954:2013),YFS2013$SSB[,2],YFS2013$SSB[,2]+1.96*as.numeric(as.vector(std2013[['V4']][559:618])),YFS2013$SSB[,2]-1.96*as.numeric(as.vector(std2013[['V4']][559:618]))))
ret12=data.frame(cbind(c(1954:2012),YFS2012$SSB[,2],YFS2012$SSB[,2]+1.96*as.numeric(as.vector(std2012[['V4']][552:610])),YFS2012$SSB[,2]-1.96*as.numeric(as.vector(std2012[['V4']][552:610]))))
retro22_0=as.data.frame(rbind(ret12,ret13,ret14,ret15,ret16,ret17,ret18,ret19,ret20,ret21,ret22))
colnames(retro)=c("Year","Female_Spawning_Biomass","UI","LI")
year=rev(c(rep("2022",length(c(1954:2022))),rep("2021",length(c(1954:2021))),rep("2020",length(c(1954:2020))),rep("2019",length(c(1954:2019))),rep("2018",length(c(1954:2018))),rep("2017",length(c(1954:2017))),rep("2016",length(c(1954:2016))),rep("2015",length(c(1954:2015))),rep("2014",length(c(1954:2014))),rep("2013",length(c(1954:2013))),rep("2012",length(c(1954:2012)))))
retro22_0=as.data.frame(rbind(ret12,ret13,ret14,ret15,ret16,ret17,ret18,ret19,ret20,ret21,ret22))
colnames(retro)=c("Year","Female_Spawning_Biomass","UI","LI")
retro22_0
dim(retro22_0)
head(retro())
head(retro
)
head(retro22_0)
colnames(retro22_0)=c("Year","Female_Spawning_Biomass","UI","LI")
year=rev(c(rep("2022",length(c(1954:2022))),rep("2021",length(c(1954:2021))),rep("2020",length(c(1954:2020))),rep("2019",length(c(1954:2019))),rep("2018",length(c(1954:2018))),rep("2017",length(c(1954:2017))),rep("2016",length(c(1954:2016))),rep("2015",length(c(1954:2015))),rep("2014",length(c(1954:2014))),rep("2013",length(c(1954:2013))),rep("2012",length(c(1954:2012)))))
retro=cbind(retro22_0,year)
theme_set(theme_gray(base_size = 18))
p22_0=ggplot(data=retro,aes(x=Year,y=Female_Spawning_Biomass,ymin=LI,ymax=UI))+geom_ribbon(aes(fill=year),alpha=0.3)+geom_line(aes(color=year))+ylab("Female Spawning Biomass (t)")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_0+ggtitle("Model 22.0")
p22_0+ggtitle("Model 22.0")
std2022=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_0/fm.std")
std2021=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_1/fm.std")
std2020=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_2/fm.std")
std2019=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_3/fm.std")
std2018=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_4/fm.std")
std2017=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_5/fm.std")
std2016=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_6/fm.std")
std2015=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_7/fm.std")
std2014=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_8/fm.std")
std2013=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_9/fm.std")
std2012=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_10/fm.std")
ret22=data.frame(cbind(c(1954:2022),YFS2022$SSB[,2],YFS2022$SSB[,2]+1.96*as.numeric(as.vector(std2022[['V4']][622:690])),YFS2022$SSB[,2]-1.96*as.numeric(as.vector(std2022[['V4']][622:690]))))
ret21=data.frame(cbind(c(1954:2021),YFS2021r$SSB[,2],YFS2021r$SSB[,2]+1.96*as.numeric(as.vector(std2021[['V4']][615:682])),YFS2021r$SSB[,2]-1.96*as.numeric(as.vector(std2021[['V4']][615:682]))))
ret20=data.frame(cbind(c(1954:2020),YFS2020$SSB[,2],YFS2020$SSB[,2]+1.96*as.numeric(as.vector(std2020[['V4']][608:674])),YFS2020$SSB[,2]-1.96*as.numeric(as.vector(std2020[['V4']][608:674]))))
ret19=data.frame(cbind(c(1954:2019),YFS2019$SSB[,2],YFS2019$SSB[,2]+1.96*as.numeric(as.vector(std2019[['V4']][601:666])),YFS2019$SSB[,2]-1.96*as.numeric(as.vector(std2019[['V4']][601:666]))))
ret18=data.frame(cbind(c(1954:2018),YFS2018$SSB[,2],YFS2018$SSB[,2]+1.96*as.numeric(as.vector(std2018[['V4']][594:658])),YFS2018$SSB[,2]-1.96*as.numeric(as.vector(std2018[['V4']][594:658]))))
ret17=data.frame(cbind(c(1954:2017),YFS2017$SSB[,2],YFS2017$SSB[,2]+1.96*as.numeric(as.vector(std2017[['V4']][587:650])),YFS2017$SSB[,2]-1.96*as.numeric(as.vector(std2017[['V4']][587:650]))))
ret16=data.frame(cbind(c(1954:2016),YFS2016$SSB[,2],YFS2016$SSB[,2]+1.96*as.numeric(as.vector(std2016[['V4']][580:642])),YFS2016$SSB[,2]-1.96*as.numeric(as.vector(std2016[['V4']][580:642]))))
ret15=data.frame(cbind(c(1954:2015),YFS2015$SSB[,2],YFS2015$SSB[,2]+1.96*as.numeric(as.vector(std2015[['V4']][573:634])),YFS2015$SSB[,2]-1.96*as.numeric(as.vector(std2015[['V4']][573:634]))))
ret14=data.frame(cbind(c(1954:2014),YFS2014$SSB[,2],YFS2014$SSB[,2]+1.96*as.numeric(as.vector(std2014[['V4']][566:626])),YFS2014$SSB[,2]-1.96*as.numeric(as.vector(std2014[['V4']][566:626]))))
ret13=data.frame(cbind(c(1954:2013),YFS2013$SSB[,2],YFS2013$SSB[,2]+1.96*as.numeric(as.vector(std2013[['V4']][559:618])),YFS2013$SSB[,2]-1.96*as.numeric(as.vector(std2013[['V4']][559:618]))))
ret12=data.frame(cbind(c(1954:2012),YFS2012$SSB[,2],YFS2012$SSB[,2]+1.96*as.numeric(as.vector(std2012[['V4']][552:610])),YFS2012$SSB[,2]-1.96*as.numeric(as.vector(std2012[['V4']][552:610]))))
retro22_1=as.data.frame(rbind(ret12,ret13,ret14,ret15,ret16,ret17,ret18,ret19,ret20,ret21,ret22))
colnames(retro22_1)=c("Year","Female_Spawning_Biomass","UI","LI")
year=rev(c(rep("2022",length(c(1954:2022))),rep("2021",length(c(1954:2021))),rep("2020",length(c(1954:2020))),rep("2019",length(c(1954:2019))),rep("2018",length(c(1954:2018))),rep("2017",length(c(1954:2017))),rep("2016",length(c(1954:2016))),rep("2015",length(c(1954:2015))),rep("2014",length(c(1954:2014))),rep("2013",length(c(1954:2013))),rep("2012",length(c(1954:2012)))))
retro=cbind(retro22_1,year)
theme_set(theme_gray(base_size = 18))
p22_1=ggplot(data=retro,aes(x=Year,y=Female_Spawning_Biomass,ymin=LI,ymax=UI))+geom_ribbon(aes(fill=year),alpha=0.3)+geom_line(aes(color=year))+ylab("Female Spawning Biomass (t)")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_1+ggtitle("Model 22.1")
dim(YFS2012$SSB)
dim(YFS2021r$SSB)
std2022=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_0/fm.std")
std2021=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_1/fm.std")
std2020=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_2/fm.std")
std2019=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_3/fm.std")
std2018=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_4/fm.std")
std2017=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_5/fm.std")
std2016=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_6/fm.std")
std2015=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_7/fm.std")
std2014=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_8/fm.std")
std2013=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_9/fm.std")
std2012=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_0/retro_10/fm.std")
ret22=data.frame(cbind(c(1954:2022),YFS2022$SSB[,2],YFS2022$SSB[,2]+1.96*as.numeric(as.vector(std2022[['V4']][622:690])),YFS2022$SSB[,2]-1.96*as.numeric(as.vector(std2022[['V4']][622:690]))))
ret21=data.frame(cbind(c(1954:2021),YFS2021r$SSB[,2],YFS2021r$SSB[,2]+1.96*as.numeric(as.vector(std2021[['V4']][615:682])),YFS2021r$SSB[,2]-1.96*as.numeric(as.vector(std2021[['V4']][615:682]))))
ret20=data.frame(cbind(c(1954:2020),YFS2020$SSB[,2],YFS2020$SSB[,2]+1.96*as.numeric(as.vector(std2020[['V4']][608:674])),YFS2020$SSB[,2]-1.96*as.numeric(as.vector(std2020[['V4']][608:674]))))
ret19=data.frame(cbind(c(1954:2019),YFS2019$SSB[,2],YFS2019$SSB[,2]+1.96*as.numeric(as.vector(std2019[['V4']][601:666])),YFS2019$SSB[,2]-1.96*as.numeric(as.vector(std2019[['V4']][601:666]))))
ret18=data.frame(cbind(c(1954:2018),YFS2018$SSB[,2],YFS2018$SSB[,2]+1.96*as.numeric(as.vector(std2018[['V4']][594:658])),YFS2018$SSB[,2]-1.96*as.numeric(as.vector(std2018[['V4']][594:658]))))
ret17=data.frame(cbind(c(1954:2017),YFS2017$SSB[,2],YFS2017$SSB[,2]+1.96*as.numeric(as.vector(std2017[['V4']][587:650])),YFS2017$SSB[,2]-1.96*as.numeric(as.vector(std2017[['V4']][587:650]))))
ret16=data.frame(cbind(c(1954:2016),YFS2016$SSB[,2],YFS2016$SSB[,2]+1.96*as.numeric(as.vector(std2016[['V4']][580:642])),YFS2016$SSB[,2]-1.96*as.numeric(as.vector(std2016[['V4']][580:642]))))
ret15=data.frame(cbind(c(1954:2015),YFS2015$SSB[,2],YFS2015$SSB[,2]+1.96*as.numeric(as.vector(std2015[['V4']][573:634])),YFS2015$SSB[,2]-1.96*as.numeric(as.vector(std2015[['V4']][573:634]))))
ret14=data.frame(cbind(c(1954:2014),YFS2014$SSB[,2],YFS2014$SSB[,2]+1.96*as.numeric(as.vector(std2014[['V4']][566:626])),YFS2014$SSB[,2]-1.96*as.numeric(as.vector(std2014[['V4']][566:626]))))
ret13=data.frame(cbind(c(1954:2013),YFS2013$SSB[,2],YFS2013$SSB[,2]+1.96*as.numeric(as.vector(std2013[['V4']][559:618])),YFS2013$SSB[,2]-1.96*as.numeric(as.vector(std2013[['V4']][559:618]))))
ret12=data.frame(cbind(c(1954:2012),YFS2012$SSB[,2],YFS2012$SSB[,2]+1.96*as.numeric(as.vector(std2012[['V4']][552:610])),YFS2012$SSB[,2]-1.96*as.numeric(as.vector(std2012[['V4']][552:610]))))
retro22_0=as.data.frame(rbind(ret12,ret13,ret14,ret15,ret16,ret17,ret18,ret19,ret20,ret21,ret22))
colnames(retro22_0)=c("Year","Female_Spawning_Biomass","UI","LI")
year=rev(c(rep("2022",length(c(1954:2022))),rep("2021",length(c(1954:2021))),rep("2020",length(c(1954:2020))),rep("2019",length(c(1954:2019))),rep("2018",length(c(1954:2018))),rep("2017",length(c(1954:2017))),rep("2016",length(c(1954:2016))),rep("2015",length(c(1954:2015))),rep("2014",length(c(1954:2014))),rep("2013",length(c(1954:2013))),rep("2012",length(c(1954:2012)))))
retro=cbind(retro22_0,year)
theme_set(theme_gray(base_size = 18))
p22_0=ggplot(data=retro,aes(x=Year,y=Female_Spawning_Biomass,ymin=LI,ymax=UI))+geom_ribbon(aes(fill=year),alpha=0.3)+geom_line(aes(color=year))+ylab("Female Spawning Biomass (t)")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_0+ggtitle("Model 22.0")
Years=c(c(1954:2021),c(1954:2020),c(1954:2019),c(1954:2018),c(1954:2017),c(1954:2016),c(1954:2015),c(1954:2014),c(1954:2013),c(1954:2012))
Difference=c(-1*(YFS2022$SSB[1:68,2]-YFS2021r$SSB[,2])/YFS2022$SSB[1:68,2],
-1*(YFS2022$SSB[1:67,2]-YFS2020r$SSB[,2])/YFS2022$SSB[1:67,2],
-1*(YFS2022$SSB[1:66,2]-YFS2019$SSB[,2])/YFS2022$SSB[1:66,2],
-1*(YFS2022$SSB[1:65,2]-YFS2018$SSB[,2])/YFS2022$SSB[1:65,2],
-1*(YFS2022$SSB[1:64,2]-YFS2017$SSB[,2])/YFS2022$SSB[1:64,2],
-1*(YFS2022$SSB[1:63,2]-YFS2016$SSB[,2])/YFS2022$SSB[1:63,2],
-1*(YFS2022$SSB[1:62,2]-YFS2015$SSB[,2])/YFS2022$SSB[1:62,2],
-1*(YFS2022$SSB[1:61,2]-YFS2014$SSB[,2])/YFS2022$SSB[1:61,2],
-1*(YFS2022$SSB[1:60,2]-YFS2013$SSB[,2])/YFS2022$SSB[1:60,2],
-1*(YFS2022$SSB[1:59,2]-YFS2012$SSB[,2])/YFS2022$SSB[1:59,2])
Difference=c(-1*(YFS2022$SSB[1:68,2]-YFS2021r$SSB[,2])/YFS2022$SSB[1:68,2],
-1*(YFS2022$SSB[1:67,2]-YFS2020$SSB[,2])/YFS2022$SSB[1:67,2],
-1*(YFS2022$SSB[1:66,2]-YFS2019$SSB[,2])/YFS2022$SSB[1:66,2],
-1*(YFS2022$SSB[1:65,2]-YFS2018$SSB[,2])/YFS2022$SSB[1:65,2],
-1*(YFS2022$SSB[1:64,2]-YFS2017$SSB[,2])/YFS2022$SSB[1:64,2],
-1*(YFS2022$SSB[1:63,2]-YFS2016$SSB[,2])/YFS2022$SSB[1:63,2],
-1*(YFS2022$SSB[1:62,2]-YFS2015$SSB[,2])/YFS2022$SSB[1:62,2],
-1*(YFS2022$SSB[1:61,2]-YFS2014$SSB[,2])/YFS2022$SSB[1:61,2],
-1*(YFS2022$SSB[1:60,2]-YFS2013$SSB[,2])/YFS2022$SSB[1:60,2],
-1*(YFS2022$SSB[1:59,2]-YFS2012$SSB[,2])/YFS2022$SSB[1:59,2])
Year=(c(rep("2021",length(c(1954:2021))),rep("2020",length(c(1954:2020))),rep("2019",length(c(1954:2019))),rep("2018",length(c(1954:2018))),rep("2017",length(c(1954:2017))),rep("2016",length(c(1954:2016))),rep("2015",length(c(1954:2015))),rep("2014",length(c(1954:2014))),rep("2013",length(c(1954:2013))),rep("2012",length(c(1954:2012)))))
dat=data.frame(Years,Difference,Year)
ggplot(data=dat,aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
ggplot(data=dat[which(dat$Years>1974),],aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1974,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
ggplot(data=dat[which(dat$Years>1974),],aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1974,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_0=ggplot(data=dat,aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_0+ggtitle("Model 22.0")
p22_0+ggtitle("Model 22.0")
p22_0_sm=ggplot(data=dat[which(dat$Years>1974),],aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1974,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_0_sm+ggtitle("Model 22.0")
p22_0_sm+ggtitle("Model 22.0")
std2022=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_0/fm.std")
std2021=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_1/fm.std")
std2020=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_2/fm.std")
std2019=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_3/fm.std")
std2018=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_4/fm.std")
std2017=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_5/fm.std")
std2016=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_6/fm.std")
std2015=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_7/fm.std")
std2014=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_8/fm.std")
std2013=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_9/fm.std")
std2012=read.table("/Users/ingridspies/admbmodels/BSAI_YFS/assessments/yfs/runs/retro22_1/retro_10/fm.std")
ret22=data.frame(cbind(c(1954:2022),YFS2022$SSB[,2],YFS2022$SSB[,2]+1.96*as.numeric(as.vector(std2022[['V4']][622:690])),YFS2022$SSB[,2]-1.96*as.numeric(as.vector(std2022[['V4']][622:690]))))
ret21=data.frame(cbind(c(1954:2021),YFS2021r$SSB[,2],YFS2021r$SSB[,2]+1.96*as.numeric(as.vector(std2021[['V4']][615:682])),YFS2021r$SSB[,2]-1.96*as.numeric(as.vector(std2021[['V4']][615:682]))))
ret20=data.frame(cbind(c(1954:2020),YFS2020$SSB[,2],YFS2020$SSB[,2]+1.96*as.numeric(as.vector(std2020[['V4']][608:674])),YFS2020$SSB[,2]-1.96*as.numeric(as.vector(std2020[['V4']][608:674]))))
ret19=data.frame(cbind(c(1954:2019),YFS2019$SSB[,2],YFS2019$SSB[,2]+1.96*as.numeric(as.vector(std2019[['V4']][601:666])),YFS2019$SSB[,2]-1.96*as.numeric(as.vector(std2019[['V4']][601:666]))))
ret18=data.frame(cbind(c(1954:2018),YFS2018$SSB[,2],YFS2018$SSB[,2]+1.96*as.numeric(as.vector(std2018[['V4']][594:658])),YFS2018$SSB[,2]-1.96*as.numeric(as.vector(std2018[['V4']][594:658]))))
ret17=data.frame(cbind(c(1954:2017),YFS2017$SSB[,2],YFS2017$SSB[,2]+1.96*as.numeric(as.vector(std2017[['V4']][587:650])),YFS2017$SSB[,2]-1.96*as.numeric(as.vector(std2017[['V4']][587:650]))))
ret16=data.frame(cbind(c(1954:2016),YFS2016$SSB[,2],YFS2016$SSB[,2]+1.96*as.numeric(as.vector(std2016[['V4']][580:642])),YFS2016$SSB[,2]-1.96*as.numeric(as.vector(std2016[['V4']][580:642]))))
ret15=data.frame(cbind(c(1954:2015),YFS2015$SSB[,2],YFS2015$SSB[,2]+1.96*as.numeric(as.vector(std2015[['V4']][573:634])),YFS2015$SSB[,2]-1.96*as.numeric(as.vector(std2015[['V4']][573:634]))))
ret14=data.frame(cbind(c(1954:2014),YFS2014$SSB[,2],YFS2014$SSB[,2]+1.96*as.numeric(as.vector(std2014[['V4']][566:626])),YFS2014$SSB[,2]-1.96*as.numeric(as.vector(std2014[['V4']][566:626]))))
ret13=data.frame(cbind(c(1954:2013),YFS2013$SSB[,2],YFS2013$SSB[,2]+1.96*as.numeric(as.vector(std2013[['V4']][559:618])),YFS2013$SSB[,2]-1.96*as.numeric(as.vector(std2013[['V4']][559:618]))))
ret12=data.frame(cbind(c(1954:2012),YFS2012$SSB[,2],YFS2012$SSB[,2]+1.96*as.numeric(as.vector(std2012[['V4']][552:610])),YFS2012$SSB[,2]-1.96*as.numeric(as.vector(std2012[['V4']][552:610]))))
retro22_1=as.data.frame(rbind(ret12,ret13,ret14,ret15,ret16,ret17,ret18,ret19,ret20,ret21,ret22))
colnames(retro22_1)=c("Year","Female_Spawning_Biomass","UI","LI")
year=rev(c(rep("2022",length(c(1954:2022))),rep("2021",length(c(1954:2021))),rep("2020",length(c(1954:2020))),rep("2019",length(c(1954:2019))),rep("2018",length(c(1954:2018))),rep("2017",length(c(1954:2017))),rep("2016",length(c(1954:2016))),rep("2015",length(c(1954:2015))),rep("2014",length(c(1954:2014))),rep("2013",length(c(1954:2013))),rep("2012",length(c(1954:2012)))))
retro=cbind(retro22_1,year)
theme_set(theme_gray(base_size = 18))
p22_1=ggplot(data=retro,aes(x=Year,y=Female_Spawning_Biomass,ymin=LI,ymax=UI))+geom_ribbon(aes(fill=year),alpha=0.3)+geom_line(aes(color=year))+ylab("Female Spawning Biomass (t)")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_1+ggtitle("Model 22.1")
Years=c(c(1954:2021),c(1954:2020),c(1954:2019),c(1954:2018),c(1954:2017),c(1954:2016),c(1954:2015),c(1954:2014),c(1954:2013),c(1954:2012))
Difference=c(-1*(YFS2022$SSB[1:68,2]-YFS2021r$SSB[,2])/YFS2022$SSB[1:68,2],
-1*(YFS2022$SSB[1:67,2]-YFS2020r$SSB[,2])/YFS2022$SSB[1:67,2],
-1*(YFS2022$SSB[1:66,2]-YFS2019$SSB[,2])/YFS2022$SSB[1:66,2],
-1*(YFS2022$SSB[1:65,2]-YFS2018$SSB[,2])/YFS2022$SSB[1:65,2],
-1*(YFS2022$SSB[1:64,2]-YFS2017$SSB[,2])/YFS2022$SSB[1:64,2],
-1*(YFS2022$SSB[1:63,2]-YFS2016$SSB[,2])/YFS2022$SSB[1:63,2],
-1*(YFS2022$SSB[1:62,2]-YFS2015$SSB[,2])/YFS2022$SSB[1:62,2],
-1*(YFS2022$SSB[1:61,2]-YFS2014$SSB[,2])/YFS2022$SSB[1:61,2],
-1*(YFS2022$SSB[1:60,2]-YFS2013$SSB[,2])/YFS2022$SSB[1:60,2],
-1*(YFS2022$SSB[1:59,2]-YFS2012$SSB[,2])/YFS2022$SSB[1:59,2])
Years=c(c(1954:2021),c(1954:2020),c(1954:2019),c(1954:2018),c(1954:2017),c(1954:2016),c(1954:2015),c(1954:2014),c(1954:2013),c(1954:2012))
Difference=c(-1*(YFS2022$SSB[1:68,2]-YFS2021r$SSB[,2])/YFS2022$SSB[1:68,2],
-1*(YFS2022$SSB[1:67,2]-YFS2020$SSB[,2])/YFS2022$SSB[1:67,2],
-1*(YFS2022$SSB[1:66,2]-YFS2019$SSB[,2])/YFS2022$SSB[1:66,2],
-1*(YFS2022$SSB[1:65,2]-YFS2018$SSB[,2])/YFS2022$SSB[1:65,2],
-1*(YFS2022$SSB[1:64,2]-YFS2017$SSB[,2])/YFS2022$SSB[1:64,2],
-1*(YFS2022$SSB[1:63,2]-YFS2016$SSB[,2])/YFS2022$SSB[1:63,2],
-1*(YFS2022$SSB[1:62,2]-YFS2015$SSB[,2])/YFS2022$SSB[1:62,2],
-1*(YFS2022$SSB[1:61,2]-YFS2014$SSB[,2])/YFS2022$SSB[1:61,2],
-1*(YFS2022$SSB[1:60,2]-YFS2013$SSB[,2])/YFS2022$SSB[1:60,2],
-1*(YFS2022$SSB[1:59,2]-YFS2012$SSB[,2])/YFS2022$SSB[1:59,2])
Year=(c(rep("2021",length(c(1954:2021))),rep("2020",length(c(1954:2020))),rep("2019",length(c(1954:2019))),rep("2018",length(c(1954:2018))),rep("2017",length(c(1954:2017))),rep("2016",length(c(1954:2016))),rep("2015",length(c(1954:2015))),rep("2014",length(c(1954:2014))),rep("2013",length(c(1954:2013))),rep("2012",length(c(1954:2012)))))
dat=data.frame(Years,Difference,Year)
p22_1=ggplot(data=dat,aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
#save as retro22_1b.pdf
p22_1_sm=ggplot(data=dat[which(dat$Years>1974),],aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1974,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_1=ggplot(data=dat,aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_1+ggtitle("Model 22.1")
p22_1=ggplot(data=dat,aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_1+ggtitle("Model 22.1")
p22_1_sm=ggplot(data=dat[which(dat$Years>1974),],aes(x=Years,y=Difference,type=Year))+geom_line(aes(x=Years,y=Difference, color=Year))+ylab("Difference")+xlab("Year")+theme_bw()+theme(legend.text=element_text(size=11),axis.text=element_text(size=9),axis.title.x = element_text(size=14),axis.title.y = element_text(size=14))+scale_x_continuous(breaks = seq(1974,2022, by = 2))+theme(axis.text.x=element_text(angle=90,hjust=-1))
p22_1_sm+ggtitle("Model 22.1")
#Here plot weight at length by decade to look at whether weight at length seems to have changed.
#I built a data frame that combines weight age and year and decade.
#wtageyr=data.frame(cbind(srv_wtage$LENGTH,srv_wtage$WEIGHT,srv_wtage$Year))
#write.csv(wtageyr,"/Users/ingridspies/Downloads/wtageyr.csv")
srv_wtage=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/YFS/2021/survey_wtage/YFSageSurvey1954_2021.csv",header=TRUE)
wtageyr=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/YFS/2022/wtageyr.csv",header=TRUE)
wtageyr$Decade=as.factor(wtageyr$Decade)
wtageyr=cbind(wtageyr,srv_wtage$SEX)
colnames(wtageyr)[6]="Sex"
#colnames(wtageyr)=c("Length","Weight","Year")
#ggplot(wtageyr)+geom_point(aes(x=Length,y=Weight,col=Decade),na.rm=TRUE)+ggtitle("Yellowfin Sole Weight at Length, by decade")+theme_bw()
#Calculate weight at length for all YFS over all time
x=wtageyr$Length[which(wtageyr$Sex==2)]
y=wtageyr$Weight[which(wtageyr$Sex==2)]
#nls(y~a*x^b,start=list(a=.003915,b=3.2232))
a_all=3.348e-06;b_all= 3.219#*** parameters for model females!
#plot(x,y/1000,col="red",xlab="Length (mm)",ylab="Weight (kg)",las=1,cex.lab=1.4,cex.axis=1.2)
#text(200,5,"Growth in first year \nof very small ones \nis strange - \nunits error?")
#lines(seq(1,1200,1),(a_all*seq(1,1200,1)^b_all)/1000,lwd=2,lty=1)
#legend("topleft",c("Fitted line","Raw Data"),col=c("black","red"),pch=c(-1,20),lty=c(1,-1),lwd=2,cex=1.2,bty="n")
#LOok at weight at length by decade
x=wtageyr$Length[which(wtageyr$Year<1980&wtageyr$Sex==2)]
y=wtageyr$Weight[which(wtageyr$Year<1980&wtageyr$Sex==2)];length(y)
M1970=nls(y~a*x^b,start=list(a=.003915,b=3.2232))
#plot(x,y/1000,col="green",xlab="Length (mm)",ylab="Weight (kg)",las=1,cex.lab=1.4,cex.axis=1.2)
a_all70=7.426e-06;b_all70=3.075
#lines(seq(1,1200,1),(a_all70*seq(1,1200,1)^b_all70)/1000,lwd=2,lty=1,col="green")
x=wtageyr$Length[which(wtageyr$Year<1990&wtageyr$Year>1980&wtageyr$Sex==2)]
y=wtageyr$Weight[which(wtageyr$Year<1990&wtageyr$Year>1980&wtageyr$Sex==2)];length(y)
M1980=nls(y~a*x^b,start=list(a=.003915,b=3.2232))
a_all80=6.610e-06;b_all80=3.104
#points(x,y/1000,col="blue")
#lines(seq(1,1200,1),(a_all80*seq(1,1200,1)^b_all80)/1000,lwd=2,lty=1,col="blue")
x=wtageyr$Length[which(wtageyr$Year<2000&wtageyr$Year>1990&wtageyr$Sex==2)]
y=wtageyr$Weight[which(wtageyr$Year<2000&wtageyr$Year>1990&wtageyr$Sex==2)];length(y)
M1990=nls(y~a*x^b,start=list(a=.003915,b=3.2232))
a_all90=1.793e-06;b_all90=3.320
#points(x,y/1000,col="orange")
#lines(seq(1,1200,1),(a_all90*seq(1,1200,1)^b_all90)/1000,lwd=2,lty=1,col="orange")
x=wtageyr$Length[which(wtageyr$Year<2010&wtageyr$Year>2000&wtageyr$Sex==2)]
y=wtageyr$Weight[which(wtageyr$Year<2010&wtageyr$Year>2000&wtageyr$Sex==2)];length(y)
M2000=nls(y~a*x^b,start=list(a=.003915,b=3.2232))
a_all2000=3.479e-06;b_all2000=3.211
#points(x,y/1000,col="red")
#lines(seq(1,1200,1),(a_all2000*seq(1,1200,1)^b_all2000)/1000,lwd=2,lty=1,col="red")
x=wtageyr$Length[which(wtageyr$Year>2010&wtageyr$Sex==2)]
y=wtageyr$Weight[which(wtageyr$Year>2010&wtageyr$Sex==2)];length(y)
M2010=nls(y~a*x^b,start=list(a=.003915,b=3.2232))
a_all2010=4.198e-06;b_all2010=3.182
#points(x,y/1000,col="purple")
#lines(seq(1,1200,1),(a_all2010*seq(1,1200,1)^b_all2010)/1000,lwd=2,lty=1,col="purple")
#legend("topleft",c("1970's","1980's","1990's","2000's","2020's"),col=c("green","blue","orange","red","purple"),pch=c(-1,-1,-1,-1,-1),lty=c(1,1,1,1,1),lwd=2,cex=1.2,bty="n")
#Best over time weight plot.
x=wtageyr$Length[which(wtageyr$Sex==2)]#Females
y=wtageyr$Weight[which(wtageyr$Sex==2)]#Females
#x=wtageyr$Length
#y=wtageyr$Weight
plot(x,y/1000,col="grey",xlab="Length (mm)",ylab="Weight (g)",las=1,cex.lab=1.4,cex.axis=1.2)
#text(200,5,"Growth in first year \nof very small ones \nis strange - \nunits error?")
lines(seq(1,1200,1),(a_all70*seq(1,1200,1)^b_all70)/1000,lwd=2,lty=1,col="green")
lines(seq(1,1200,1),(a_all80*seq(1,1200,1)^b_all80)/1000,lwd=2,lty=1,col="blue")
lines(seq(1,1200,1),(a_all90*seq(1,1200,1)^b_all90)/1000,lwd=2,lty=1,col="orange")
lines(seq(1,1200,1),(a_all2000*seq(1,1200,1)^b_all2000)/1000,lwd=2,lty=1,col="red")
lines(seq(1,1200,1),(a_all2010*seq(1,1200,1)^b_all2010)/1000,lwd=2,lty=1,col="purple")
#x=wtageyr$Length[which(wtageyr$Sex==2)]
#y=wtageyr$Weight[which(wtageyr$Sex==2)]
#points(x,y/1000,col="black")
legend("topleft",c("1970's","1980's","1990's","2000's","2020's","Raw Data (Females)"),col=c("green","blue","orange","red","purple","grey"),pch=c(-1,-1,-1,-1,-1,20),lty=c(1,1,1,1,1,-1),lwd=2,cex=1.2,bty="n")
recf=data.frame(YFS22_0$Yr[1:69],YFS22_0$natage_f[1:69,5]+YFS22_0$natage_m[1:69,5])
colnames(recf)=c("Year","Recruitment")
ggplot(data=recf[1:66,])+geom_bar(aes(x=Year,y=Recruitment),alpha=0.4,stat="identity")+geom_hline(yintercept=mean(YFS18_2$natage_f[1:66,5]+YFS18_2$natage_m[1:66,5]))+theme_bw()+scale_x_continuous(breaks = seq(1954,2022, by = 2))+theme(axis.text.x=element_text(angle=45,hjust=1))+ylab("Recruitment, age 5, billions of fish")
mean(YFS22_0$natage_f[1:66,5]+YFS22_0$natage_m[1:66,5])
mean(YFS22_1$natage_f[1:66,5]+YFS22_1$natage_m[1:66,5])
#Figure 32 get this from SSB in 5 yr average catch in alt3.
pcatch=read.table("/Users/ingridspies/admbmodels/projection/bsai_yfin2022_out/percentiles.out",nrows=14,skip=144)
colnames(pcatch)=c("Year","C0","Cabc","Cofl","LowCI_Catch ","Median_Catch","Mean_Catch","UpperCI_Catch","Stdev_Catch")
pSSB=read.table("/Users/ingridspies/admbmodels/projection/bsai_yfin2022_out/percentiles.out",nrows=14,skip=161)
colnames(pSSB)=c("Year","SSB100","SSBabc","SSBofl","LowCI_SSB","Median_SSB","Mean_SSB","UpperCI_SSB","Stdev_SSB")
plot(pSSB$Year,pSSB$Mean_SSB,type="l",ylim=c(0,1500),lwd=3,col="blue", xlab="Year",ylab="Female Spawning Biomass",cex.axis=1.4,cex.lab=1.4)
lines(pSSB$Year,pSSB$LowCI_SSB,lty=2,lwd=2)
lines(pSSB$Year,pSSB$UpperCI_SSB,lty=2,lwd=2)
abline(h=Bmsy_this/1000,col="red",lwd=2)
text(2023,(Bmsy_this/1000)+60,expression(B[MSY]),cex=1.4)
Femz=YFS18_2$oac_fsh_s[,1:20]
Malz=YFS18_2$oac_fsh_s[,21:40]
yrs=length(seq(1975,2021,1))
Age=rep(seq(1,20,1),each=yrs)
Frequency=c(Femz)
Year=rep(seq(1975,2021,1),length(yrs))
fishlen=data.frame(Year,Age,Frequency)
Fem <- ggplot(fishlen, aes(Age,Year)) +
geom_tile(aes(fill = Frequency),colour = "lightgrey")+
scale_fill_gradient(low = "white",high = "darkblue")+
scale_y_continuous(breaks=seq(1975,2021,2),labels=seq(1975,2021,2))+
ggtitle("YFS Ages - Fishery Females") +
theme(axis.text.y=element_text(size=rel(.7)))+theme_bw()
Frequency=c(Malz)
Year=rep(seq(1975,2021,1),length(yrs))
fishlen=data.frame(Year,Age,Frequency)
Mal <- ggplot(fishlen, aes(Age,Year)) +
geom_tile(aes(fill = Frequency),colour = "lightgrey")+
scale_fill_gradient(low = "white",high = "darkblue")+
scale_y_continuous(breaks=seq(1975,2021,2),labels=seq(1975,2021,2))+
ggtitle("YFS Ages - Fishery Males") +
theme(axis.text.y=element_text(size=rel(.7)))+theme_bw()
grid.arrange(Fem,Mal,ncol=1)
cn5
cn5=mean(as.numeric(c(cn4,Catch[36])))#126157.4t
catchZ=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/YFS/2022/catch_YFS.csv",header=TRUE,skip=1)
prop=sum(YFS_catch$Catch..mt.[which(YFS_catch$Month<10&YFS_catch$Year<2022&YFS_catch$Year>2016&YFS_catch$FMP.Subarea=="BS")],na.rm=TRUE)/sum(YFS_catch$Catch..mt.[which(YFS_catch$Year<2022&YFS_catch$Year>2016&YFS_catch$FMP.Subarea=="BS")],na.rm=TRUE)
YFS_catch=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/YFS/2022/Groundfish_Total_Catch_by_Fishery_YFS_9_28_22_1991_2022.csv",header=TRUE)
catchZ=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/YFS/2022/catch_YFS.csv",header=TRUE,skip=1)
prop=sum(YFS_catch$Catch..mt.[which(YFS_catch$Month<10&YFS_catch$Year<2022&YFS_catch$Year>2016&YFS_catch$FMP.Subarea=="BS")],na.rm=TRUE)/sum(YFS_catch$Catch..mt.[which(YFS_catch$Year<2022&YFS_catch$Year>2016&YFS_catch$FMP.Subarea=="BS")],na.rm=TRUE)
#Between 2017 and 2021, 83.07% of the YFS catch was caught by
#estimate catch
yrz=seq(1987,2022,1)
for(i in 1:length(yrz)){
Catch[i]=sum(YFS_catch$Catch..mt.[which(YFS_catch$Year==yrz[i])])
}
#estimate catch
yrz=seq(1987,2022,1)
Catch=vector()
for(i in 1:length(yrz)){
Catch[i]=sum(YFS_catch$Catch..mt.[which(YFS_catch$Year==yrz[i])])
}
#Estimated catch for all of 2021:
Catch[36]=Catch[36]/prop #Estimate 127712.8t for BS and AI.
#cn5 is the estimate of catch for the past 5 years (2018-2022) including the current years projections
c4=catchZ$BS[(nrow(catchZ)-4):(nrow(catchZ)-1)]
cn4=str_replace(c4, ",", "")
cn5=mean(as.numeric(c(cn4,Catch[36])))#126157.4t
cn5
Catch[36]
cn5
1000*mean(bigfile$ABC[which(bigfile$Yr==2023&bigfile$Alternative==1)])
cn5
par(mar=c(5,5,3,2))
par(mfrow=c(1,1))
F40=ABC_OFL22_0$HM_Fmsyr[1]
B40=ABC_OFL22_0$Bmsy[1]
FOFL=ABC_OFL22_0$AM_Fmsyr[1]
plot(0,0,xlim=c(0,max(YFS22_0$SSB[,2])*1.1),ylim=c(0,FOFL*1.6),col=1,xlab="Estimated female spawning biomass (x 1,000 t)",ylab="Estimated fishing mortality rate",cex.axis=1.2,cex.lab=1.1,pch=-1,cex=.00001)
segments(0,0,B40,F40,col="green",lwd=4)
segments(B40,F40,max(YFS22_0$SSB[,2])*1.1,F40,col="green",lwd=4)
abline(h=FOFL,lty=1)
abline(v=B40,lty=2)
legend("topright",c(expression("F" ["OFL"]),expression("B" ["MSY"]),expression("F" ["MSY"])),lwd=c(1,1,4),lty=c(1,2,1), col=c("black","black","green"),cex=1.1,bty="n")
#note: female and male fishing mortality rate is the same
points(YFS22_0$SSB[21:69,2],YFS22_0$F_f[21:69,19],type="l",col="red",lwd=4)
points(YFS22_0$SSB[69,2],YFS22_0$F_f[69,19],pch=15,col="red")
text(YFS22_0$SSB[69,2]-100,YFS22_0$F_f[69,19]+.005,"2022",cex=0.9)
#for(i in 1: 59){
#text(ATF2019$fspbio[i]  ,ATF2019$fishmort[i],labels=as.character(seq(1961,2019,1))[i],cex=0.9)}
points(ABC_OFL22_0$SSB[1],ABC_OFL22_0$Catch_Assump[1]/ABC_OFL22_0$GM_Biom[1],pch=15,col="blue")
text(ABC_OFL22_0$SSB[1],(ABC_OFL22_0$Catch_Assump[1]/ABC_OFL22_0$GM_Biom[1])+.009,"2023",cex=0.9)
points(ABC_OFL22_0$SSB[2]+20,ABC_OFL22_0$Catch_Assump[2]/ABC_OFL22_0$GM_Biom[2],pch=15,col="black")
text(ABC_OFL22_0$SSB[2]-60,(ABC_OFL22_0$Catch_Assump[2]/ABC_OFL22_0$GM_Biom[2])-.007,"2024",cex=0.9)
AI_len_fish=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/AI_Cod/2021/Data/Fishery/norpac_length_report_AI_Pcod_10_28_22.csv",header=TRUE)
AI_len_fish=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/AI_Cod/2022/norpac_length_report_AI_Pcod_10_28_22.csv",header=TRUE)
AI_len_fish=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/AI_Cod/2022/norpac_length_report_AI_Pcod_10_28_22.csv",header=TRUE)
yrz=seq(1991,2021,1)
for(i in 1:length(yrz)){
lenpy[i]=sum(AI_len_fish$Frequency[which(AI_len_fish$Year==yrz[i])])
}
lenpy=vector()
yrz=seq(1991,2022,1)
for(i in 1:length(yrz)){
lenpy[i]=sum(AI_len_fish$Frequency[which(AI_len_fish$Year==yrz[i])])
}
Fish_len=data.frame(cbind(seq(1991,2022,1),formatC(as.numeric(lenpy),format="d",big.mark=",")))
colnames(Fish_len)=c("Year","Number of Lengths")
Fish_len
mods2 <- SS_output("/Users/ingridspies/admbmodels/AI_Pcod/2022_SS/AI_Pcod-SS/Stock_Synthesis_files/Model2_Nov_simple/",verbose=FALSE,printstats=FALSE)
srvbio=cbind(
mods2$cpue$Yr[which(mods2$cpue$Fleet_name=="Srv")], mods2$cpue$Obs[which(mods2$cpue$Fleet_name=="Srv")], mods2$cpue$SE_input[which(mods2$cpue$Fleet_name=="Srv")],
mods2$cpue$Obs[which(mods2$cpue$Fleet_name=="LLSrv")],
mods2$cpue$SE_input[which(mods2$cpue$Fleet_name=="LLSrv")])
srvbio=set_na(srvbio, na = c(var1 = 1.0, var2 = 1.0000000))
colnames(srvbio)=c("Year","Biomass (t)","S.E.","Index","S.E.")
options(knitr.kable.NA = '')
srvbio
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(kableExtra)
library(stringr)
library(sjlabelled)
library(sjmisc)
library(r4ss)
library(FSA)
library(FSA)
install.packages(FSA)
install.packages("FSA")
data<-data.table(read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/AI_Cod/2022/codmaturity_9_20_2021.csv"))
dataAI<-data[NMFS_AREA%in%c(540:544)]
dataAI120<-dataAI[MONTH<=4&YEAR>2007&SEX=='F']   ## Restrict it to beginning of the year and years 2008-2019
my_ogive_fq = gonad_mature(dataAI120,varNames = c("LENGTH", "MATURITY_DESCRIPTION"), inmName = "Immature",matName = c("Pre Spawn","Spawning","Spent","Developing","Resting" ), method = "bayes", niter = 999)
library(FSA)
my_ogive_fq = gonad_mature(dataAI120,varNames = c("LENGTH", "MATURITY_DESCRIPTION"), inmName = "Immature",matName = c("Pre Spawn","Spawning","Spent","Developing","Resting" ), method = "bayes", niter = 999)
library(r4ss)
library(FSA)
library(nlstools)
install.packages("nlstools")
library(data.table)
library(sizeMat)
my_ogive_fq = gonad_mature(dataAI120,varNames = c("LENGTH", "MATURITY_DESCRIPTION"), inmName = "Immature",matName = c("Pre Spawn","Spawning","Spent","Developing","Resting" ), method = "bayes", niter = 999)
library(sizeMat)
install.packages("sizeMat")
my_ogive_fq = gonad_mature(dataAI120,varNames = c("LENGTH", "MATURITY_DESCRIPTION"), inmName = "Immature",matName = c("Pre Spawn","Spawning","Spent","Developing","Resting" ), method = "bayes", niter = 999)
library(sizeMat)
my_ogive_fq = gonad_mature(dataAI120,varNames = c("LENGTH", "MATURITY_DESCRIPTION"), inmName = "Immature",matName = c("Pre Spawn","Spawning","Spent","Developing","Resting" ), method = "bayes", niter = 999)
length=seq(4,143,1)
A=median(my_ogive_fq$A_boot)
B=median(my_ogive_fq$B_boot)
mat_est=(1/(1+exp(-(A + B*length))));
length=seq(1,117,1)
A=median(my_ogive_fq$A_boot)
mat_est=(1/(1+exp(-(A + B*length))));
Mest=read.csv("/Users/ingridspies/Documents/WorkDellStuff/Assessments/AI_Cod/2022/M_estimates_stats2.csv",header=TRUE)
library(ss3diags)
library(r4ss)
dir3=("/Users/ingridspies/admbmodels/AI_Pcod/2022_SS/AI_Pcod-SS/Stock_Synthesis_files/Model3/")
mod3 <- SS_output(dir = dir3)
SS_plots(mod3)
dir3
#To run this: in starter.ss change the AIPCOD21.ctl to control_modified.ss.
#In line 12 of starter.ss, do 0 # 0=use init values in control file; 1=use ss.par
#Also, line 19 of starter.ss: 1 # Include prior_like for non-estimated parameters (0,1)
#in the starter.ss change the control model to control_modified.ss.
#Model1
R0.vec <- c(seq(10,10.9,.1))
Nprofile <- length(R0.vec)
#To run this: in starter.ss change the AIPCOD21.ctl to control_modified.ss.
#In line 12 of starter.ss, do 0 # 0=use init values in control file; 1=use ss.par
#Also, line 19 of starter.ss: 1 # Include prior_like for non-estimated parameters (0,1)
#in the starter.ss change the control model to control_modified.ss.
#Model1
R0.vec <- c(seq(10,10.9,.5))
Nprofile <- length(R0.vec)
Mod3Profile <- r4ss::profile(
exe = "ss_osx",
dir = dir4, # directory
oldctlfile = "AIPCOD21.ctl",
newctlfile = "control_modified.ss",
string = "SR_LN(R0)",
profilevec=R0.vec
)
Mod3Profile <- r4ss::profile(
exe = "ss_osx",
dir = dir3, # directory
oldctlfile = "AIPCOD21.ctl",
newctlfile = "control_modified.ss",
string = "SR_LN(R0)",
profilevec=R0.vec
)
profilemodels <- SSgetoutput(dirvec=dir3, keyvec=1:Nprofile)
profilesummary <- SSsummarize(profilemodels)
n <- length(profilemodels)
n
# plot profile using summary created above
SSplotProfile(profilesummary,           # summary object
string = "SR_LN(R0)", # substring of profile parameter
profile.label="SR_LN(R0)")
PinerPlot(profilesummary,plot=TRUE,ymax=10)
warnings()
library(r4ss)
dir1=("/Users/ingridspies/admbmodels/AI_Pcod/2022_SS/AI_Pcod-SS/Stock_Synthesis_files/Model1_Nov_complex")
mods1 <- SS_output(dir1)
SS_plots(mods1)
YFS22_1$nsmpl_srv_s
mod1 <- SS_output(dir = dir1)
dir1=("/Users/ingridspies/admbmodels/AI_Pcod/2022_SS/AI_Pcod-SS/Stock_Synthesis_files/Model1_Nov_complex")
mods1 <- SS_output(dir1)
SS_plots(mods1)
